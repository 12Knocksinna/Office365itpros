#Report-TeamsEmojis.PS1
# A quick and simple script to report the usage of emojis as reactions to Teams chat and channel conversation messages

# V1.0 6-Nov-2025
# GitHub Link:

# Connect to Microsoft Graph to fetch user information
Connect-MgGraph -Scopes "User.ReadBasic.All"

$UserInfoAvailable = $false

# Fetching user information
[array]$Users = Get-MgUser -All -PageSize 999 -Property DisplayName, UserPrincipalName

If ($Users) {
    Write-Output ("Fetched {0} users from the tenant." -f $Users.Count)
    $UserHash = @{}
    ForEach ($User in $Users) {
        $UserHash.Add($User.UserPrincipalName, $User.DisplayName)
    }
    $UserInfoAvailable = $true

}   Else {
    Write-Output "No users found in the tenant."
    Break
}

# Check if Exchange Online is already connected - otherwise connect
If ($Null -eq (Get-ConnectionInformation)) {
    Write-Host "Connecting to Exchange Online..."
    Connect-ExchangeOnline -ShowBanner:$false
}

# Build hash table to resolve reaction name to the emoji shown in Teams
$Emojis = @{}
$Emojis.Add("head shaking vertically", "ğŸ¤¦â€â™‚ï¸")
$Emojis.Add("head shaking horizontally", "ğŸ¤¦â€â™€ï¸")
$Emojis.Add("thumbs up", "ğŸ‘")
$Emojis.Add("thumbs down", "ğŸ‘")
$Emojis.Add("like", "ğŸ‘")
$Emojis.Add("heart", "â¤ï¸")
$Emojis.Add("laugh", "ğŸ˜‚")
$Emojis.Add("peekingeye", "ğŸ™ˆ")
$Emojis.Add("surprised", "ğŸ˜®")
$Emojis.Add("sad", "ğŸ˜¢")
$Emojis.Add("saddog", "ğŸ¶")
$Emojis.Add("angry", "ğŸ˜ ")
$Emojis.Add("yes-tone1", "ğŸ‘ğŸ»")
$Emojis.Add("blankface", "ğŸ˜")
$Emojis.Add("bowing", "ğŸ™‡")
$Emojis.Add("call", "ğŸ“")
$Emojis.Add("cool", "ğŸ˜")
$Emojis.Add("cry", "ğŸ˜¢")
$Emojis.Add("coolkoala", "ğŸ¦˜")
$Emojis.Add("eyeinspeechbubble", "ğŸ‘ï¸â€ğŸ—¨ï¸")
$Emojis.Add("fire", "ğŸ”¥")
$Emojis.Add("fistbump", "ğŸ‘Š")
$Emojis.Add("follow", "ğŸ‘£")
$Emojis.Add("grinningfacewithsmilingeyes", "ğŸ˜")
$Emojis.Add("handsinair", "ğŸ™Œ")
$Emojis.Add("heartblue", "ğŸ’™")
$Emojis.Add("hearteyes", "ğŸ˜")
$Emojis.Add("happyface", "ğŸ˜Š")
$Emojis.Add("loudlycrying", "ğŸ˜­")
$Emojis.Add("personmotorwheelchairright2tone1", "ğŸ§‘ğŸ»â€ğŸ¦¼")
$Emojis.Add("rainbowsmileyface", "ğŸŒˆ")
$Emojis.Add("clap", "ğŸ‘")
$Emojis.Add("smilingfacewithtear", "ğŸ¥²")
$Emojis.Add("squintingfacewithtongue", "ğŸ˜œ")
$Emojis.Add("2714_heavycheckmark", "âœ”ï¸")
$Emojis.Add("mickeymouse;0-neu-d1-63cc7d1c9164d9a1b23ae85714dd20fa", "ğŸ­")
$Emojis.Add("think", "ğŸ¤”")
$Emojis.Add("1f51c_soon", "ğŸ”œ")
$Emojis.Add("1f6a2_ship", "ğŸš¢")
$Emojis.Add("1f4ce_paperclip", "ğŸ“")
$Emojis.Add("relieved", "ğŸ˜Œ")
$Emojis.Add("rofl", "ğŸ¤£")
$Emojis.Add("peekingeyes", "ğŸ™ˆ")
$Emojis.Add("1f3a8_artistpalette", "ğŸ¨")
$Emojis.Add("1f458_kimono", "ğŸ‘˜")
$Emojis.Add("1f4a4_zzz", "ğŸ’¤")
$Emojis.Add("1f4af_hundredpointssymbol", "ğŸ’¯")
$Emojis.Add("1f603_grinningfacewithbigeyes", "ğŸ˜ƒ")
$Emojis.Add("1f920_facewithcowboyhat", "ğŸ¤ ")
$Emojis.Add("1f627_anguishedface", "ğŸ˜§")
$Emojis.Add("1f911_moneymouthface", "ğŸ¤‘")
$Emojis.Add("1f915_facewithheadbandage", "ğŸ¤•")
$Emojis.Add("1f4a1_electriclightbulb", "ğŸ’¡")
$Emojis.Add("1f917_huggingface", "ğŸ¤—")
$Emojis.Add("1f97a_pleadingface", "ğŸ¥º")
$Emojis.Add("1f92a_zanyface", "ğŸ¤ª")
$Emojis.Add("1f9b7_tooth", "ğŸ¦·")
$Emojis.Add("203c_doubleexclamationmark", "â€¼ï¸")
$Emojis.Add("1f440_eyes", "ğŸ‘€")
$Emojis.Add("2795_heavyplussign", "â•")
$Emojis.Add("2796_heavyminussign", "â–")   
$Emojis.Add("1f389_partypopper", "ğŸ‰") 
$Emojis.Add("screamingfear", "ğŸ˜±")
$Emojis.Add("womanraisinghand", "ğŸ™‹â€â™€ï¸ ")
$Emojis.Add("support", "ğŸ†˜")
$Emojis.Add("callme", "ğŸ§˜â€â™‚ï¸")
$Emojis.Add("Vampire-tone3", "ğŸ§›ğŸ½â€â™‚ï¸")
$Emojis.Add("sweatgrinning", "ğŸ˜…")
$Emojis.Add("ttm", "ğŸˆ¶")
$Emojis.Add("oreoyum", "ğŸª")
$Emojis.Add("victory", "âœŒï¸")
$Emojis.Add("vulcansalute", "ğŸ––")
$Emojis.Add("rainbowsmile", "ğŸŒˆ")
$Emojis.Add("smile", "ğŸ˜„")
$Emojis.Add("womandeveloper", "ğŸ‘©â€ğŸ’»")
$Emojis.Add("whew", "ğŸ˜®â€ğŸ’¨")

$StartDate = (Get-Date).AddDays(-360) 
$EndDate = (Get-Date).AddDays(1)

# Find audit records for Teams emoji reactions
Write-Output "Looking for audit records..."
[array]$Records = Search-UnifiedAuditLog -StartDate $StartDate -EndDate $EndDate -Operations ReactedToMessage -Formatted -SessionCommand ReturnLargeSet -ResultSize 5000
If ($Records.Count -eq 0) {
    Write-Output "No Teams emoji reaction records found"
    Break
}   Else {
    $Records = $Records | Sort-Object Identity -Unique
    Write-Output ("Found {0} Teams emoji reaction records to process..." -f $Records.Count)
    $Report = [System.Collections.Generic.List[Object]]::new()  
}

# Genreate the report
ForEach ($Rec in $Records) {

    $AuditData = $Rec.AuditData | ConvertFrom-Json
    Try {
        $Emoji = $Emojis[$AuditData.MessageReactionType]
    } Catch {
        $Emoji = $null
    }
    If ($Null -eq $Emoji) {
        $Emoji = $AuditData.MessageReactionType
    }
    # Is the message from a chat or a channel conversation?
    $Channel = $AuditData.ChannelName
    $Team = $AuditData.TeamName
    If ($Null -eq $Channel) {
        $Channel = "Chat"
        $Team = $null
    }

    $Reaction = $AuditData.MessageReactionType
    If ($null -eq $Reaction) {
       $Reaction = $AuditData.OldValue + " (Removed)"
    }

    # Get user displayname if user info is available
    If ($UserInfoAvailable) {
        $UserDisplayName = $UserHash[$Rec.UserIds]
        If ($Null -eq $UserDisplayName) {
            $UserDisplayName = $Rec.UserIds
        }
    }   Else {
        $UserDisplayName = $Rec.UserIds
    }

    $ReportLine = [PSCustomObject][Ordered]@{ 
        User            = $UserDisplayName
        Reaction        = $Reaction
        Emoji           = $Emoji
        ReactionTime    = $Rec.CreationDate
        Channel         = $Channel
        Team            = $Team
        ParentMessageId = $AuditData.ParentMessageId
        UserId           = $Rec.UserIds
    }
    $Report.Add($ReportLine)
}

$Report = $Report | Sort-Object {$_.ReactionTime -as [datetime]}
$Report | Out-GridView -Title "Teams Emoji Reactions Report"

Write-Output ""
Write-Output "Top ten Emoji reactions used in Teams"    
$Report | Group-Object Reaction -NoElement | Sort-Object Count -Descending | Select-Object -First 10 | Format-Table Name, Count
Write-Output ""
Write-Output "Top ten Users who reacted with Emojis in Teams"
$Report | Group-Object User -NoElement | Sort-Object Count -Descending | Select-Object -First 10 | Format-Table Name, Count

# An example script used to illustrate a concept. More information about the topic can be found in the Office 365 for IT Pros eBook https://gum.co/O365IT/
# and/or a relevant article on https://office365itpros.com or https://www.practical365.com. See our post about the Office 365 for IT Pros repository # https://office365itpros.com/office-365-github-repository/ for information about the scripts we write.

# Do not use our scripts in production until you are satisfied that the code meets the need of your organization. Never run any code downloaded from the Internet without
# first validating the code in a non-production environment.
